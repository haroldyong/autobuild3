#!/bin/bash
##pacman packing script
##@copyright GPL-2.0+
PIF="$SRCDIR/PKGINFO"

pacpkgver(){ ((PKGEPOCH)) && echo -n $PKGEPOCH:; echo -n "$PKGVER"; ((PKGREL)) && echo "-$PKGREL"; }

makepkginfo () {
	cat << EOF
# maintainer: $MTER
# Generated by autobuild3, definitely a bad idea for actual use
pkgname=$(printf %q "$PKGNAME)
epoch=$(printf %q "${PKGEPOCH:-0}")
version=$(printf %q "$PKGVER")
release=$(printf %q "$PKGREL")
pkgdesc=$(printf %q "$PKGDES")
size=$(du -s "$PKGDIR" | cut -f 1)
# arch=${CROSS:-$ARCH}
$([ "$PKGSEC" ] && echo "group=$PKGSEC" )
# FIXME: FLATDEP only!
depends=( $(printf '%q ' $(pm_deflat $PKGDEP)) )
EOF
}

makepkginfo > "$PIF"
bsdtar -f "${PKGNAME}_${PKGVER}-${PKGREL}_${CROSS:-$ARCH}.pkg.tar.xz" -cJ "$PKGDIR/" "$PIF"
